<div class="operation-container">
    <div class="title">
        Campaign Execution Panel
    </div>

    <div class="execution-status" *ngIf="campaignRecruitStatus">
        <div class="status-item">
            <div class="icon">
                <svg width="38" height="38" viewBox="0 0 38 38" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path
                        d="M17.9979 37.0889C8.57573 37.0889 0.9104 29.4236 0.9104 20.0012C0.9104 12.9203 5.16895 6.6742 11.7598 4.08867C11.8987 4.03526 12.0463 4.00785 12.1952 4.00781C12.442 4.00889 12.6828 4.08426 12.8862 4.22411C13.0897 4.36395 13.2462 4.5618 13.3356 4.79189C13.5735 5.41134 13.2658 6.1162 12.65 6.36314C7.00302 8.57812 3.35287 13.9318 3.35287 20.0012C3.35287 28.0767 9.92263 34.6464 17.9979 34.6464C24.0709 34.6462 29.5829 30.8278 31.7139 25.1449C31.8037 24.9156 31.9604 24.7186 32.1635 24.5795C32.3667 24.4403 32.6069 24.3654 32.8532 24.3644C33.0031 24.3644 33.1518 24.3921 33.2916 24.4462C33.9092 24.6843 34.2269 25.3834 33.9999 26.005C31.5142 32.6338 25.0829 37.0889 17.9979 37.0889H17.9979Z"
                        fill="#414BB2"
                    />
                    <path
                        d="M17.999 21.2217C17.6752 21.2212 17.3648 21.0924 17.1359 20.8635C16.907 20.6345 16.7781 20.3242 16.7776 20.0004V1.74648C16.7779 1.42273 16.9067 1.11233 17.1356 0.883397C17.3645 0.654468 17.6749 0.525713 17.9987 0.525391C28.7375 0.525391 37.474 9.26181 37.474 20.0004C37.4736 20.3243 37.3448 20.6347 37.1157 20.8637C36.8867 21.0927 36.5762 21.2214 36.2524 21.2217H17.9989H17.999ZM19.2203 18.779H34.9909L34.9638 18.4754C34.2313 10.2614 27.7381 3.76797 19.5241 3.0355L19.2203 3.00841V18.779Z"
                        fill="#414BB2"
                    />
                </svg>
            </div>
            <div class="content">
                <div class="number">{{ getRecruitedInfluencerSize }} + {{ getAcceptedInfluencerSize }} / {{ campaignRecruitStatus.quota }}</div>
                <div class="item">Quota filled</div>
            </div>
        </div>
        <div class="status-item">
            <div class="icon">
                <svg width="34" height="32" viewBox="0 0 34 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path
                        d="M32.5564 12.6675H31.4453V6.00087C31.4453 5.70618 31.3283 5.42357 31.1199 5.21519C30.9115 5.00682 30.6289 4.88976 30.3342 4.88976H3.66755C3.40445 4.89405 3.14837 4.80483 2.9449 4.63798C2.74142 4.47113 2.60377 4.23749 2.55644 3.97865V3.57865C2.60377 3.3198 2.74142 3.08616 2.9449 2.91931C3.14837 2.75246 3.40445 2.66324 3.66755 2.66753H29.8675C30.1622 2.66753 30.4449 2.55047 30.6532 2.3421C30.8616 2.13372 30.9787 1.85111 30.9787 1.55642C30.9787 1.26174 30.8616 0.979123 30.6532 0.77075C30.4449 0.562376 30.1622 0.445313 29.8675 0.445312H3.66755C2.7835 0.445312 1.93565 0.796502 1.31053 1.42162C0.685408 2.04674 0.334218 2.89459 0.334218 3.77865C0.326419 3.91187 0.326419 4.04543 0.334218 4.17865V27.0342C0.33858 27.6325 0.460736 28.224 0.693713 28.775C0.92669 29.3261 1.26592 29.8258 1.69204 30.2457C2.11817 30.6657 2.62283 30.9976 3.17722 31.2224C3.7316 31.4473 4.32486 31.5608 4.92311 31.5564H30.3342C30.6289 31.5564 30.9115 31.4394 31.1199 31.231C31.3283 31.0226 31.4453 30.74 31.4453 30.4453V23.7786H32.5564C32.8511 23.7786 33.1337 23.6616 33.3421 23.4532C33.5505 23.2448 33.6675 22.9622 33.6675 22.6675V13.7786C33.6675 13.484 33.5505 13.2013 33.3421 12.993C33.1337 12.7846 32.8511 12.6675 32.5564 12.6675ZM29.2231 29.3342H4.92311C4.30511 29.3402 3.70975 29.1019 3.26654 28.6712C2.82333 28.2404 2.56813 27.6521 2.55644 27.0342V6.97865C2.91711 7.08317 3.2924 7.1282 3.66755 7.11198H29.2231V12.6675H21.4453C19.9719 12.6675 18.5588 13.2529 17.517 14.2947C16.4751 15.3366 15.8898 16.7497 15.8898 18.2231C15.8898 19.6965 16.4751 21.1096 17.517 22.1515C18.5588 23.1933 19.9719 23.7786 21.4453 23.7786H29.2231V29.3342ZM31.4453 21.5564H21.4453C20.5613 21.5564 19.7134 21.2052 19.0883 20.5801C18.4632 19.955 18.112 19.1071 18.112 18.2231C18.112 17.339 18.4632 16.4912 19.0883 15.8661C19.7134 15.2409 20.5613 14.8898 21.4453 14.8898H31.4453V21.5564Z"
                        fill="#414BB2"
                    />
                </svg>
            </div>
            <div class="content">
                <div class="number">$ {{ getTotalCommission | number }} / {{ campaign.budget | number }}</div>
                <div class="item">Total commission</div>
            </div>
        </div>
        <div class="status-item">
            <div class="icon">
                <svg width="30" height="36" viewBox="0 0 30 36" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path
                        d="M24.3631 8.94602L26.7848 6.52435L29.1414 8.88101L26.7198 11.3027C29.1127 14.298 30.268 18.0958 29.9482 21.9162C29.6285 25.7367 27.8581 29.2897 25.0006 31.8455C22.1431 34.4014 18.4154 35.7662 14.5831 35.6595C10.7508 35.5528 7.10479 33.9828 4.39389 31.2719C1.683 28.561 0.112987 24.915 0.006303 21.0827C-0.100381 17.2504 1.26436 13.5227 3.82024 10.6652C6.37612 7.80769 9.92912 6.03727 13.7496 5.71755C17.57 5.39782 21.3678 6.55307 24.3631 8.94602ZM14.9998 32.3327C16.5319 32.3327 18.0489 32.0309 19.4644 31.4446C20.8799 30.8583 22.166 29.9989 23.2494 28.9156C24.3327 27.8322 25.1921 26.5461 25.7784 25.1307C26.3647 23.7152 26.6664 22.1981 26.6664 20.666C26.6664 19.1339 26.3647 17.6168 25.7784 16.2014C25.1921 14.7859 24.3327 13.4998 23.2494 12.4164C22.166 11.3331 20.8799 10.4737 19.4644 9.88742C18.0489 9.30112 16.5319 8.99935 14.9998 8.99935C11.9056 8.99935 8.93812 10.2285 6.75019 12.4164C4.56227 14.6044 3.33311 17.5718 3.33311 20.666C3.33311 23.7602 4.56227 26.7277 6.75019 28.9156C8.93812 31.1035 11.9056 32.3327 14.9998 32.3327ZM13.3331 12.3327H16.6664V22.3327H13.3331V12.3327ZM8.33311 0.666016H21.6664V3.99935H8.33311V0.666016Z"
                        fill="#414BB2"
                    />
                </svg>
            </div>
            <div class="content">
                <div class="number">
                    {{ getCampaignDeadline }}
                </div>
                <div class="item">Deadline</div>
            </div>
        </div>
        <div class="status-item">
            <div class="icon">
                <svg width="34" height="32" viewBox="0 0 34 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path
                        d="M32.5564 12.6675H31.4453V6.00087C31.4453 5.70618 31.3283 5.42357 31.1199 5.21519C30.9115 5.00682 30.6289 4.88976 30.3342 4.88976H3.66755C3.40445 4.89405 3.14837 4.80483 2.9449 4.63798C2.74142 4.47113 2.60377 4.23749 2.55644 3.97865V3.57865C2.60377 3.3198 2.74142 3.08616 2.9449 2.91931C3.14837 2.75246 3.40445 2.66324 3.66755 2.66753H29.8675C30.1622 2.66753 30.4449 2.55047 30.6532 2.3421C30.8616 2.13372 30.9787 1.85111 30.9787 1.55642C30.9787 1.26174 30.8616 0.979123 30.6532 0.77075C30.4449 0.562376 30.1622 0.445313 29.8675 0.445312H3.66755C2.7835 0.445312 1.93565 0.796502 1.31053 1.42162C0.685408 2.04674 0.334218 2.89459 0.334218 3.77865C0.326419 3.91187 0.326419 4.04543 0.334218 4.17865V27.0342C0.33858 27.6325 0.460736 28.224 0.693713 28.775C0.92669 29.3261 1.26592 29.8258 1.69204 30.2457C2.11817 30.6657 2.62283 30.9976 3.17722 31.2224C3.7316 31.4473 4.32486 31.5608 4.92311 31.5564H30.3342C30.6289 31.5564 30.9115 31.4394 31.1199 31.231C31.3283 31.0226 31.4453 30.74 31.4453 30.4453V23.7786H32.5564C32.8511 23.7786 33.1337 23.6616 33.3421 23.4532C33.5505 23.2448 33.6675 22.9622 33.6675 22.6675V13.7786C33.6675 13.484 33.5505 13.2013 33.3421 12.993C33.1337 12.7846 32.8511 12.6675 32.5564 12.6675ZM29.2231 29.3342H4.92311C4.30511 29.3402 3.70975 29.1019 3.26654 28.6712C2.82333 28.2404 2.56813 27.6521 2.55644 27.0342V6.97865C2.91711 7.08317 3.2924 7.1282 3.66755 7.11198H29.2231V12.6675H21.4453C19.9719 12.6675 18.5588 13.2529 17.517 14.2947C16.4751 15.3366 15.8898 16.7497 15.8898 18.2231C15.8898 19.6965 16.4751 21.1096 17.517 22.1515C18.5588 23.1933 19.9719 23.7786 21.4453 23.7786H29.2231V29.3342ZM31.4453 21.5564H21.4453C20.5613 21.5564 19.7134 21.2052 19.0883 20.5801C18.4632 19.955 18.112 19.1071 18.112 18.2231C18.112 17.339 18.4632 16.4912 19.0883 15.8661C19.7134 15.2409 20.5613 14.8898 21.4453 14.8898H31.4453V21.5564Z"
                        fill="#414BB2"
                    />
                </svg>
            </div>
            <div class="content">
                <div class="number">
                    {{ getTotalFollowers | number }}
                </div>
                <div class="item">Total Followers</div>
            </div>
        </div>
    </div>
    <div class="title">
        Recruited Influencers
    </div>
    <div class="empty-message" *ngIf="!recruitedInfluencers || recruitedInfluencers.length <= 0">
        No influencer has accpet invitation or you haven't send any invitation.
    </div>
    <div class="download">
        <button nz-button nzSize="small" nzType="primary" (click)="download()">
            Download
        </button>
    </div>
    <div class="discovery-table" *ngIf="recruitedInfluencers && recruitedInfluencers.length > 0">
        <nz-table #nzTable [nzData]="recruitedInfluencers" nzTableLayout="fixed">
            <thead>
                <tr>
                    <th nzWidth="340px">Influencers
                        <nz-filter-trigger [(nzVisible)]="recruitVisible" [nzActive]="recruitSearchValue.length > 0" [nzDropdownMenu]="recruitFilter">
                            <i nz-icon nzType="search" style="font-size: 20px; color: #414bb2;"></i>
                        </nz-filter-trigger>
                    </th>
                    <th [nzSortFn]="sortByStatus" 
                        [nzFilterFn]="filterByStatus"
                        [nzFilters]="listOfStatus">Status</th>
                    <th [nzSortFn]="sortBySource">Source</th>
                    <th>Followers</th>
                    <th>Commission</th>
                    <th>Bonus</th>
                    <th nzWidth="40px"></th>
                </tr>
            </thead>
            <tbody>
                <ng-container *ngFor="let data of nzTable.data">
                    <tr>
                        <td>
                            <div class="image-holder">
                                <img src="{{ data.profile.influencer.profile.picture }}" />
                                <i class="like-icon" nz-icon nzType="like" nzTheme="fill" *ngIf="data.profile.highlyRecommend"></i>
                            </div>
                            <div class="user-profile">
                                <div class="profile-container">
                                    <div class="user-name">{{ data.profile.influencer.profile.fullname }}</div>
                                    <div class="user-name-link">
                                        <span (click)="openInsPage(data.profile.influencer)"
                                            >@{{ data.profile.influencer.profile.username }}</span
                                        >
                                    </div>
                                </div>
                            </div>
                        </td>
                        <td>
                            {{ getStatus(data) }}
                        </td>
                        <td> {{data.source}} </td>
                        <td> 
                            {{ data.profile.influencer.profile.followers | number }}
                        </td>
                        <td>$ {{ data.accept_commission ? data.accept_commission : 0 }}</td>
                        <td>$ {{ data.accept_bonus ? data.accept_bonus : 0 }}</td>
                        <td>
                            <i
                                nz-icon
                                class="expand-icon"
                                *ngIf="!data.expanded"
                                nzType="caret-down"
                                nzTheme="outline"
                                (click)="data.expanded = true"
                            ></i>
                            <i
                                nz-icon
                                class="expand-icon"
                                *ngIf="data.expanded"
                                nzType="caret-up"
                                nzTheme="outline"
                                (click)="data.expanded = false"
                            ></i>
                        </td>
                    </tr>
                    <tr [nzExpand]="data.expanded">
                        <app-influencer-operation
                            [campaign]="campaign"
                            [productList]="productList"
                            [influencer]="data"
                        ></app-influencer-operation>
                    </tr>
                </ng-container>
            </tbody>
        </nz-table>
        <nz-dropdown-menu #recruitFilter="nzDropdownMenu">
            <div class="ant-table-filter-dropdown">
                <div class="search-box">
                    <input type="text" nz-input placeholder="Search name" [(ngModel)]="recruitSearchValue" />
                    <button nz-button nzSize="small" nzType="primary" (click)="searchRecruit()" class="search-button">
                        Search
                    </button>
                    <button nz-button nzSize="small" (click)="resetRecruit()">Reset</button>
                </div>
            </div>
        </nz-dropdown-menu>
    </div>

    <div class="title">
        All Invited Influencers
    </div>
    <div class="empty-message" *ngIf="!invitedInfluencers || invitedInfluencers.length <= 0">
        No invited influencers at this point.
    </div>
    <div class="discovery-table" *ngIf="invitedInfluencers && invitedInfluencers.length > 0">
        <nz-table #nzTable [nzData]="invitedInfluencers" nzTableLayout="fixed">
            <thead>
                <tr>
                    <th nzWidth="340px">
                        Influencers
                        <nz-filter-trigger [(nzVisible)]="visible" [nzActive]="searchValue.length > 0" [nzDropdownMenu]="menu">
                            <i nz-icon nzType="search" style="font-size: 20px; color: #414bb2;"></i>
                        </nz-filter-trigger>
                    </th>
                    <th>Deadline</th>
                    <th>Commission</th>
                    <th>Bonus</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                <ng-container *ngFor="let data of nzTable.data">
                    <tr>
                        <td>
                            <div class="image-holder">
                                <img src="{{ data.profile.influencer.profile.picture }}" />
                                <i class="like-icon" nz-icon nzType="like" nzTheme="fill" *ngIf="data.profile.highlyRecommend"></i>
                            </div>
                            <div class="user-profile">
                                <div class="profile-container">
                                    <div class="user-name">{{ data.profile.influencer.profile.fullname }}</div>
                                    <div class="user-name-link">
                                        <span (click)="openInsPage(data.profile.influencer)"
                                            >@{{ data.profile.influencer.profile.username }}</span
                                        >
                                    </div>
                                </div>
                            </div>
                        </td>
                        <td>
                            {{ data.invitation?.inv_deadline * 1000 | date: 'MMMM d, HH:mm' }}
                        </td>
                        <td>$ {{ data.invitation?.commission }}</td>
                        <td>$ {{ countInvitationBonus(data.invitation) }}</td>
                        <td>
                            <a (click)="editInvitation(data)"><i nz-icon nzType="edit" nzTheme="outline"></i> Edit</a>
                        </td>
                    </tr>
                </ng-container>
            </tbody>
        </nz-table>
        <nz-dropdown-menu #menu="nzDropdownMenu">
            <div class="ant-table-filter-dropdown">
                <div class="search-box">
                    <input type="text" nz-input placeholder="Search name" [(ngModel)]="searchValue" />
                    <button nz-button nzSize="small" nzType="primary" (click)="search()" class="search-button">
                        Search
                    </button>
                    <button nz-button nzSize="small" (click)="reset()">Reset</button>
                </div>
            </div>
        </nz-dropdown-menu>
    </div>

    <div class="title">
        Applied Influencers
    </div>
    <div class="empty-message" *ngIf="!appliedInfluencers || appliedInfluencers.length <= 0">
        No application at this point.
    </div>
    <div class="discovery-table" *ngIf="appliedInfluencers && appliedInfluencers.length > 0">
        <nz-table #nzTable [nzData]="appliedInfluencers" nzTableLayout="fixed">
            <thead>
                <tr>
                    <th nzWidth="340px">
                        Influencers
                        <nz-filter-trigger [(nzVisible)]="visible" [nzActive]="searchValue.length > 0" [nzDropdownMenu]="menu">
                            <i nz-icon nzType="search" style="font-size: 20px; color: #414bb2;"></i>
                        </nz-filter-trigger>
                    </th>
                    <th>Followers</th>
                    <th>Engagement Rate</th>
                    <th>Commission</th>
                    <th>Bonus</th>
                    <th nzWidth="180px">Accept</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                <ng-container *ngFor="let data of nzTable.data">
                    <tr>
                        <td>
                            <div class="image-holder">
                                <img src="{{ data.profile.influencer.profile.picture }}" />
                                <i class="like-icon" nz-icon nzType="like" nzTheme="fill" *ngIf="data.profile.highlyRecommend"></i>
                            </div>
                            <div class="user-profile">
                                <div class="profile-container">
                                    <div class="user-name">{{ data.profile.influencer.profile.fullname }}</div>
                                    <div class="user-name-link">
                                        <span (click)="openInsPage(data.profile.influencer)"
                                            >@{{ data.profile.influencer.profile.username }}</span
                                        >
                                    </div>
                                </div>
                            </div>
                        </td>
                        <td>
                            {{ data.profile.influencer.profile.followers | number }}
                        </td>
                        <td>
                            {{ data.profile.influencer.profile.engagementRate * 100 | number: '1.0-1' }}%
                        </td>
                        <td>$ {{ data.accept_commission ? data.accept_commission : 0 }}</td>
                        <td>$ {{ data.accept_bonus ? data.accept_bonus : 0 }}</td>
                        <td>
                            <a class="action-link" (click)="startAcceptApplication(data)"><i nz-icon nzType="edit" nzTheme="outline"></i> Accept</a>
                            <a *ngIf="!data.application_decline_time" (click)="startSkipApplication(data)"><i nz-icon nzType="edit" nzTheme="outline"></i> Skip</a>
                            <span *ngIf="data.application_decline_time"> Skipped </span>
                        </td>
                        <td>
                            <i
                                nz-icon
                                class="expand-icon"
                                *ngIf="!data.expanded"
                                nzType="caret-down"
                                nzTheme="outline"
                                (click)="data.expanded = true"
                            ></i>
                            <i
                                nz-icon
                                class="expand-icon"
                                *ngIf="data.expanded"
                                nzType="caret-up"
                                nzTheme="outline"
                                (click)="data.expanded = false"
                            ></i>
                        </td>
                    </tr>
                    <tr [nzExpand]="data.expanded">
                        <app-influencer-detail
                            *ngIf="data.expanded"
                            [influencer]="data.profile.influencer"
                        >
                        </app-influencer-detail>
                    </tr>
                </ng-container>
            </tbody>
        </nz-table>
        <nz-dropdown-menu #menu="nzDropdownMenu">
            <div class="ant-table-filter-dropdown">
                <div class="search-box">
                    <input type="text" nz-input placeholder="Search name" [(ngModel)]="searchValue" />
                    <button nz-button nzSize="small" nzType="primary" (click)="search()" class="search-button">
                        Search
                    </button>
                    <button nz-button nzSize="small" (click)="reset()">Reset</button>
                </div>
            </div>
        </nz-dropdown-menu>
    </div>
</div>

<nz-modal
    [(nzVisible)]="showEditInvitation"
    nzTitle="Edit Invitation"
    (nzOnCancel)="canceleditInvitation()"
    (nzOnOk)="updateInvitation()"
    nzOkText="Update"
>
    <div *ngIf="editInfluencer && editInfluencer.invitation">
        <div class="input-item">
            <div>Commission:</div>
            <nz-input-group nzPrefix="$">
                <input nz-input [(ngModel)]="editInfluencer.invitation.commission" />
            </nz-input-group>
        </div>
        <div class="input-item">
            <div>Bonus:</div>
            <nz-input-group nzSuffix="%">
                <input nz-input [(ngModel)]="editInfluencer.invitation.bonus" />
            </nz-input-group>
        </div>
        <div class="input-item">
            <div>Deadline:</div>
            <input
                #input
                nz-input
                [value]="editInfluencer.invitation.inv_deadline * 1000 | date: 'yyyy-MM-dd HH:mm:ss'"
                (keyup.enter)="deadlineBlur(input.value)"
                (blur)="deadlineBlur(input.value)"
            />
        </div>
    </div>
</nz-modal>


<nz-modal
    [(nzVisible)]="showAcceptApplication"
    nzTitle="Accept Application"
    (nzOnCancel)="cancelAcceptApplication()"
    (nzOnOk)="acceptApplication()"
    nzOkText="Accept"
>
    <div *ngIf="acceptInfluencer">
        <div class="input-item">
            <div>Commission:</div>
            <nz-input-group nzPrefix="$">
                <input nz-input [(ngModel)]="acceptInfluencer.accept_commission" />
            </nz-input-group>
        </div>
        <div class="input-item">
            <div>Bonus:</div>
            <nz-input-group nzPrefix="$">
                <input nz-input [(ngModel)]="acceptInfluencer.accept_bonus" />
            </nz-input-group>
        </div>
    </div>
</nz-modal>

<nz-modal
    [(nzVisible)]="showSkipApplication"
    nzTitle="Skip Application"
    (nzOnCancel)="cancelSkipApplication()"
    (nzOnOk)="skipApplication()"
    nzOkText="Skip"
>
    <div *ngIf="acceptInfluencer">
        Are you sure to skip this influencer’s application?
    </div>
</nz-modal>